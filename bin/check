#!/usr/bin/env ruby
# frozen_string_literal: true

# flush output immediately
$stdout.sync = true

require "rubygems"
require "bundler/setup"
require File.expand_path("../../lib/check.rb", __FILE__)
require File.expand_path("../../lib/util.rb", __FILE__)

errors = [
  Check::Encoding.batch(ARGV),
  Check::Entities.batch(ARGV),
  Check::Date.batch(ARGV),
].flatten

exit 0 if errors.empty?

$stderr.puts(errors.map do |e|
  <<~EOS
    * #{Util.bold(e.file)}
      #{e.problem}

  EOS
end.join(""))

exit 1
